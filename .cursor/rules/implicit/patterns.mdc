---
description: React/TypeScript patterns and best practices
alwaysApply: true
---

# Code Patterns for React/TypeScript Projects

## Component Patterns

### Functional Components (Always):
```typescript
// ✅ Good: Functional component with TypeScript
interface ButtonProps {
  label: string;
  onClick: () => void;
  variant?: 'primary' | 'secondary';
}

export const Button: React.FC<ButtonProps> = ({ label, onClick, variant = 'primary' }) => {
  return (
    <button className={`btn btn-${variant}`} onClick={onClick}>
      {label}
    </button>
  );
};

// ❌ Bad: Class components
class Button extends React.Component {
  // Don't use class components
}
```

### Component File Structure:
```
components/ui/Button/
├── Button.tsx           # Component implementation
├── Button.module.css    # CSS modules
├── Button.test.tsx      # Tests
└── index.ts             # Re-export
```

## Custom Hooks Pattern:

```typescript
// hooks/useGitHubData.ts
import { useState, useEffect } from 'react';

interface GitHubData {
  repos: Repository[];
  loading: boolean;
  error: Error | null;
}

export const useGitHubData = (username: string): GitHubData => {
  const [repos, setRepos] = useState<Repository[]>([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<Error | null>(null);

  useEffect(() => {
    // Fetch logic
  }, [username]);

  return { repos, loading, error };
};
```

## State Management Patterns

### Zustand (Preferred for Local State):
```typescript
// store/visualizationStore.ts
import { create } from 'zustand';

interface VisualizationState {
  selectedRepo: string | null;
  viewMode: '2D' | '3D';
  setSelectedRepo: (repo: string) => void;
  setViewMode: (mode: '2D' | '3D') => void;
}

export const useVisualizationStore = create<VisualizationState>((set) => ({
  selectedRepo: null,
  viewMode: '3D',
  setSelectedRepo: (repo) => set({ selectedRepo: repo }),
  setViewMode: (mode) => set({ viewMode: mode }),
}));
```

### Redux Toolkit (For Complex State):
```typescript
// store/slices/repoSlice.ts
import { createSlice, PayloadAction } from '@reduxjs/toolkit';

interface RepoState {
  repositories: Repository[];
  filter: string;
}

const repoSlice = createSlice({
  name: 'repos',
  initialState: { repositories: [], filter: '' },
  reducers: {
    setRepositories: (state, action: PayloadAction<Repository[]>) => {
      state.repositories = action.payload;
    },
    setFilter: (state, action: PayloadAction<string>) => {
      state.filter = action.payload;
    },
  },
});

export const { setRepositories, setFilter } = repoSlice.actions;
export default repoSlice.reducer;
```

## API Service Pattern:

```typescript
// services/githubApi.ts
import axios from 'axios';

const api = axios.create({
  baseURL: 'https://api.github.com',
  headers: {
    'Accept': 'application/vnd.github.v3+json',
  },
});

export const githubApi = {
  getUser: async (username: string) => {
    const response = await api.get(`/users/${username}`);
    return response.data;
  },
  
  getRepos: async (username: string) => {
    const response = await api.get(`/users/${username}/repos`);
    return response.data;
  },
};
```

## Type Definitions:

```typescript
// types/github.ts
export interface Repository {
  id: number;
  name: string;
  description: string;
  stars: number;
  forks: number;
  language: string;
  url: string;
}

export interface GitHubUser {
  login: string;
  name: string;
  avatar_url: string;
  bio: string;
}
```

## CSS Modules Pattern:

```css
/* Button.module.css */
.button {
  padding: 0.5rem 1rem;
  border-radius: 0.25rem;
  border: none;
  cursor: pointer;
  transition: all 0.2s;
}

.primary {
  background-color: var(--nord-blue);
  color: white;
}

.secondary {
  background-color: var(--nord-gray);
  color: var(--nord-dark);
}
```

```typescript
// Button.tsx
import styles from './Button.module.css';

export const Button = ({ variant = 'primary' }) => {
  return (
    <button className={`${styles.button} ${styles[variant]}`}>
      Click me
    </button>
  );
};
```

## 3D Visualization Pattern (Three.js/React Three Fiber):

```typescript
// components/3D/RepoVisualization.tsx
import { Canvas } from '@react-three/fiber';
import { OrbitControls } from '@react-three/drei';

export const RepoVisualization: React.FC<Props> = ({ repos }) => {
  return (
    <Canvas>
      <ambientLight intensity={0.5} />
      <pointLight position={[10, 10, 10]} />
      <OrbitControls />
      {repos.map(repo => (
        <RepoNode key={repo.id} repo={repo} />
      ))}
    </Canvas>
  );
};
```

## Error Handling Pattern:

```typescript
// components/ErrorBoundary.tsx
import { Component, ErrorInfo, ReactNode } from 'react';

interface Props {
  children: ReactNode;
  fallback?: ReactNode;
}

interface State {
  hasError: boolean;
  error: Error | null;
}

export class ErrorBoundary extends Component<Props, State> {
  state: State = { hasError: false, error: null };

  static getDerivedStateFromError(error: Error): State {
    return { hasError: true, error };
  }

  componentDidCatch(error: Error, errorInfo: ErrorInfo) {
    console.error('Error caught by boundary:', error, errorInfo);
  }

  render() {
    if (this.state.hasError) {
      return this.props.fallback || <div>Something went wrong</div>;
    }
    return this.props.children;
  }
}
```

## Testing Patterns:

```typescript
// Button.test.tsx
import { render, screen, fireEvent } from '@testing-library/react';
import { Button } from './Button';

describe('Button', () => {
  it('renders with label', () => {
    render(<Button label="Click me" onClick={() => {}} />);
    expect(screen.getByText('Click me')).toBeInTheDocument();
  });

  it('calls onClick when clicked', () => {
    const handleClick = vi.fn();
    render(<Button label="Click me" onClick={handleClick} />);
    
    fireEvent.click(screen.getByText('Click me'));
    expect(handleClick).toHaveBeenCalledTimes(1);
  });
});
```

## Performance Optimization:

```typescript
// Use React.memo for expensive components
export const RepoCard = React.memo<RepoCardProps>(({ repo }) => {
  return <div>{repo.name}</div>;
});

// Use useMemo for expensive calculations
const sortedRepos = useMemo(() => {
  return repos.sort((a, b) => b.stars - a.stars);
}, [repos]);

// Use useCallback for callbacks passed to children
const handleRepoClick = useCallback((repoId: string) => {
  setSelectedRepo(repoId);
}, []);
```

## Routing Pattern (React Router):

```typescript
// App.tsx
import { BrowserRouter, Routes, Route } from 'react-router-dom';

export const App = () => {
  return (
    <BrowserRouter>
      <Routes>
        <Route path="/" element={<HomePage />} />
        <Route path="/user/:username" element={<UserPage />} />
        <Route path="/repo/:owner/:repo" element={<RepoPage />} />
        <Route path="*" element={<NotFoundPage />} />
      </Routes>
    </BrowserRouter>
  );
};
```

## Nord Theme Integration:

```css
/* globals.css */
:root {
  /* Nord Polar Night */
  --nord0: #2e3440;
  --nord1: #3b4252;
  --nord2: #434c5e;
  --nord3: #4c566a;
  
  /* Nord Snow Storm */
  --nord4: #d8dee9;
  --nord5: #e5e9f0;
  --nord6: #eceff4;
  
  /* Nord Frost */
  --nord7: #8fbcbb;
  --nord8: #88c0d0;
  --nord9: #81a1c1;
  --nord10: #5e81ac;
  
  /* Nord Aurora */
  --nord11: #bf616a;
  --nord12: #d08770;
  --nord13: #ebcb8b;
  --nord14: #a3be8c;
  --nord15: #b48ead;
}
```